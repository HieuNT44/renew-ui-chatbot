import{r as m,j as e,h as U,c as _,u as se,i as ae,B as I,o as re,t as S,s as T,k as ne,l as oe}from"./index-CZVU0qtJ.js";import{u as ce,a as ie,b as le,F as de,c as y,d as N,e as w,f as P,I as me,T as ue,g as he}from"./textarea-BT3Xj6QG.js";import{u as xe}from"./useLocation-BBfT4qYc.js";import{B as pe}from"./badge-yEeGoN0G.js";import{w as fe,B as be,P as je,C as B,E as ge,F as G,G as Ce,z as ve,T as ke,x as ye,y as Ne,X as we}from"./dropdown-menu-CqWC4q07.js";import{u as Ie,a as W,H as M,T as O,C as L,S as Se}from"./theme-switch-Da4tIi1p.js";import{g as Te,a as Pe,b as De,c as Ee,d as _e,e as Be}from"./command-CVN64_od.js";import{M as z,I as Re}from"./main-Cd2z4xQN.js";import{P as Fe,a as Ge,b as Me}from"./popover-vsa6FygB.js";import{C as A}from"./confirm-dialog-Dx1t64YG.js";import{b as Oe}from"./bots-CjEK3917.js";import{C as Le}from"./chevrons-up-down-sDu4u6UF.js";const ze=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],Ae=fe("copy",ze);var D="Checkbox",[He]=be(D),[qe,R]=He(D);function Ue(t){const{__scopeCheckbox:l,checked:o,children:u,defaultChecked:c,disabled:a,form:p,name:b,onCheckedChange:d,required:s,value:r="on",internal_do_not_use_render:n}=t,[h,v]=ge({prop:o,defaultProp:c??!1,onChange:d,caller:D}),[j,g]=m.useState(null),[k,x]=m.useState(null),f=m.useRef(!1),i=j?!!p||!!j.closest("form"):!0,E={checked:h,disabled:a,setChecked:v,control:j,setControl:g,name:b,form:p,value:r,hasConsumerStoppedPropagationRef:f,required:s,defaultChecked:C(c)?!1:c,isFormControl:i,bubbleInput:k,setBubbleInput:x};return e.jsx(qe,{scope:l,...E,children:We(n)?n(E):u})}var K="CheckboxTrigger",X=m.forwardRef(({__scopeCheckbox:t,onKeyDown:l,onClick:o,...u},c)=>{const{control:a,value:p,disabled:b,checked:d,required:s,setControl:r,setChecked:n,hasConsumerStoppedPropagationRef:h,isFormControl:v,bubbleInput:j}=R(K,t),g=U(c,r),k=m.useRef(d);return m.useEffect(()=>{const x=a?.form;if(x){const f=()=>n(k.current);return x.addEventListener("reset",f),()=>x.removeEventListener("reset",f)}},[a,n]),e.jsx(B.button,{type:"button",role:"checkbox","aria-checked":C(d)?"mixed":d,"aria-required":s,"data-state":Z(d),"data-disabled":b?"":void 0,disabled:b,value:p,...u,ref:g,onKeyDown:G(l,x=>{x.key==="Enter"&&x.preventDefault()}),onClick:G(o,x=>{n(f=>C(f)?!0:!f),j&&v&&(h.current=x.isPropagationStopped(),h.current||x.stopPropagation())})})});X.displayName=K;var V=m.forwardRef((t,l)=>{const{__scopeCheckbox:o,name:u,checked:c,defaultChecked:a,required:p,disabled:b,value:d,onCheckedChange:s,form:r,...n}=t;return e.jsx(Ue,{__scopeCheckbox:o,checked:c,defaultChecked:a,disabled:b,required:p,onCheckedChange:s,name:u,form:r,value:d,internal_do_not_use_render:({isFormControl:h})=>e.jsxs(e.Fragment,{children:[e.jsx(X,{...n,ref:l,__scopeCheckbox:o}),h&&e.jsx(Y,{__scopeCheckbox:o})]})})});V.displayName=D;var $="CheckboxIndicator",J=m.forwardRef((t,l)=>{const{__scopeCheckbox:o,forceMount:u,...c}=t,a=R($,o);return e.jsx(je,{present:u||C(a.checked)||a.checked===!0,children:e.jsx(B.span,{"data-state":Z(a.checked),"data-disabled":a.disabled?"":void 0,...c,ref:l,style:{pointerEvents:"none",...t.style}})})});J.displayName=$;var Q="CheckboxBubbleInput",Y=m.forwardRef(({__scopeCheckbox:t,...l},o)=>{const{control:u,hasConsumerStoppedPropagationRef:c,checked:a,defaultChecked:p,required:b,disabled:d,name:s,value:r,form:n,bubbleInput:h,setBubbleInput:v}=R(Q,t),j=U(o,v),g=Ie(a),k=Ce(u);m.useEffect(()=>{const f=h;if(!f)return;const i=window.HTMLInputElement.prototype,F=Object.getOwnPropertyDescriptor(i,"checked").set,ee=!c.current;if(g!==a&&F){const te=new Event("click",{bubbles:ee});f.indeterminate=C(a),F.call(f,C(a)?!1:a),f.dispatchEvent(te)}},[h,g,a,c]);const x=m.useRef(C(a)?!1:a);return e.jsx(B.input,{type:"checkbox","aria-hidden":!0,defaultChecked:p??x.current,required:b,disabled:d,name:s,value:r,form:n,...l,tabIndex:-1,ref:j,style:{...l.style,...k,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});Y.displayName=Q;function We(t){return typeof t=="function"}function C(t){return t==="indeterminate"}function Z(t){return C(t)?"indeterminate":t?"checked":"unchecked"}function Ke({className:t,...l}){return e.jsx(V,{"data-slot":"checkbox",className:_("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...l,children:e.jsx(J,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:e.jsx(W,{className:"size-3.5"})})})}const H=[{value:"data1",label:"学習データ 1"},{value:"data2",label:"学習データ 2"},{value:"data3",label:"学習データ 3"},{value:"data4",label:"学習データ 4"},{value:"data5",label:"学習データ 5"}];function Xe({value:t=[],onValueChange:l}){const[o,u]=m.useState(!1),[c,a]=m.useState(void 0),p=H.filter(s=>t.includes(s.value)),b=s=>{const r=t.includes(s)?t.filter(n=>n!==s):[...t,s];l(r)},d=(s,r)=>{s.stopPropagation();const n=t.filter(h=>h!==r);l(n)};return e.jsxs(Fe,{open:o,onOpenChange:u,children:[e.jsx(Ge,{asChild:!0,children:e.jsxs(I,{ref:s=>{s&&a(s.offsetWidth)},variant:"outline",role:"combobox",className:_("h-auto min-h-10 w-full justify-between py-2",t.length===0&&"text-muted-foreground"),children:[e.jsx("div",{className:"flex flex-1 flex-wrap items-center gap-1.5",children:p.length>0?p.map(s=>e.jsxs(pe,{variant:"secondary",className:"mr-0.5 rounded-sm bg-slate-200 px-1.5 py-0.5 text-xs dark:bg-slate-700",children:[s.label,e.jsx("button",{type:"button",className:"ring-offset-background focus:ring-ring ml-1 rounded-full outline-none focus:ring-2 focus:ring-offset-2",onKeyDown:r=>{if(r.key==="Enter"){r.preventDefault(),r.stopPropagation();const n=t.filter(h=>h!==s.value);l(n)}},onMouseDown:r=>{r.preventDefault(),r.stopPropagation()},onClick:r=>d(r,s.value),children:e.jsx(we,{className:"text-muted-foreground hover:text-foreground h-3 w-3"})})]},s.value)):e.jsx("span",{className:"text-muted-foreground",children:"学習データを選択"})}),e.jsx(Le,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(Me,{className:"p-0",align:"start",style:{width:c?`${c}px`:void 0},children:e.jsxs(Te,{children:[e.jsx(Pe,{placeholder:"学習データを検索..."}),e.jsxs(De,{children:[e.jsx(Ee,{children:"検索結果が見つかりませんでした"}),e.jsx(_e,{children:H.map(s=>{const r=t.includes(s.value);return e.jsxs(Be,{value:s.label,onSelect:()=>{b(s.value)},children:[e.jsx(W,{className:_("mr-2 h-4 w-4",r?"opacity-100":"opacity-0")}),s.label]},s.value)})})]})]})})]})}const q=`<script 
  src="http://35.213.11.57/sdk/embed.js?v1" 
  projectId="513124d5-fcb1-4cef-8c44-ee9c3e9320f3" 
  botName="Cat Company" 
  domain="http://35.213.11.57/sdk/interface.html?projectId=513124d5-fcb1-4cef-8c44-ee9c3e9320f3&nameBot=Cat Company&userId=1" 
  defer>
<\/script>`,Ve=re({name:T().min(1,"チャットボット名は必須です"),trainingData:oe(T()).min(1,"学習データを選択してください"),enableInitialGreeting:ne(),initialGreeting:T().optional(),embedScript:T()});function ct(){const t=se(),o=xe().pathname==="/chatbox/project/new";let u;try{u=ae.useParams().id}catch{u=void 0}const c=o?void 0:Oe.find(i=>i.id===u),[a,p]=m.useState(!1),[b,d]=m.useState(!1),[s,r]=m.useState(!1),n=ce({resolver:ie(Ve),defaultValues:{name:o?"":c?.name||"サンプルチャットボット",trainingData:o?[]:c?.id==="1"?["data1","data2"]:c?.id==="2"?["data3"]:["data1","data3","data4"],enableInitialGreeting:o?!1:c?.id==="1"||c?.id==="3",initialGreeting:o?"":c?.id==="1"||c?.id==="3"?"こんにちは！お問い合わせありがとうございます。どのようにお手伝いできますか？":"",embedScript:q}}),h=async()=>{try{await navigator.clipboard.writeText(q),S.success("スクリプトをコピーしました")}catch{S.error("コピーに失敗しました")}},v=le({control:n.control,name:"enableInitialGreeting"}),j=async i=>{p(!0),setTimeout(()=>{p(!1),S.success("チャットボット設定が更新されました"),t({to:"/chatbox/project"})},1e3)},g=()=>{d(!0)},k=()=>{d(!1),S.error("チャットボットが削除されました"),t({to:"/chatbox/project"})},x=()=>{r(!0)},f=()=>{r(!1),t({to:"/chatbox/project"})};return!o&&!c?e.jsxs(e.Fragment,{children:[e.jsx(M,{fixed:!0,title:"出展者ＢＯＴの管理 | 株式会社日本医工研究所",children:e.jsxs("div",{className:"ms-auto flex items-center space-x-4",children:[e.jsx(O,{}),e.jsx(L,{})]})}),e.jsx(z,{className:"flex flex-1 flex-col items-center justify-center",children:e.jsx("p",{className:"text-muted-foreground",children:"ボットが見つかりませんでした"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{fixed:!0,title:"出展者ＢＯＴの管理 | 株式会社日本医工研究所",children:e.jsxs("div",{className:"ms-auto flex items-center space-x-4",children:[e.jsx(O,{}),e.jsx(L,{})]})}),e.jsxs(z,{className:"flex flex-1 flex-col gap-4 sm:gap-6",children:[e.jsx("div",{children:e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:o?"新規チャットボット作成":"チャットボット設定"})}),e.jsx(Se,{}),e.jsx(de,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(j),className:"max-w-5xl space-y-6 px-5",children:[e.jsx(y,{control:n.control,name:"name",render:({field:i})=>e.jsxs(N,{children:[e.jsx("span",{className:"block font-bold",children:"チャットボット名"}),e.jsx(w,{children:e.jsx(Re,{placeholder:"チャットボット名を入力",...i})}),e.jsx(P,{})]})}),e.jsx(y,{control:n.control,name:"trainingData",render:({field:i})=>e.jsxs(N,{className:"flex flex-col",children:[e.jsx("span",{className:"block font-bold",children:"学習データ選択"}),e.jsx(w,{children:e.jsx(Xe,{value:i.value,onValueChange:i.onChange})}),e.jsx(P,{})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{control:n.control,name:"enableInitialGreeting",render:({field:i})=>e.jsxs(N,{className:"flex w-full flex-row items-center justify-between space-y-0 space-x-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold",children:"AIの初期挨拶"}),e.jsx(ve,{delayDuration:0,children:e.jsxs(ke,{children:[e.jsx(ye,{asChild:!0,children:e.jsx(me,{className:"text-muted-foreground h-4 w-4 cursor-help"})}),e.jsx(Ne,{className:"max-w-xs",children:e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsx("p",{children:"この機能を有効にすると、チャットボットが最初にユーザーに送信する挨拶メッセージを設定できます。"}),e.jsx("p",{children:"初期挨拶は、ユーザーがチャットを開始した際に自動的に表示され、BOTの第一印象を形成します。"})]})})]})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{children:e.jsx(Ke,{id:i.name,checked:i.value,onCheckedChange:i.onChange,className:"border-foreground/20 data-[state=checked]:border-primary border-2"})}),e.jsx("label",{htmlFor:i.name,className:"text-muted-foreground cursor-pointer text-sm",children:"有効にする"})]})]})}),e.jsx(y,{control:n.control,name:"initialGreeting",render:({field:i})=>e.jsxs(N,{children:[e.jsx(w,{children:e.jsx(ue,{placeholder:"AIの初期挨拶を入力",className:"r min-h-24 disabled:bg-gray-100 disabled:opacity-100 dark:disabled:bg-gray-800",disabled:!v,...i})}),e.jsx(P,{})]})})]}),e.jsx(y,{control:n.control,name:"embedScript",render:({field:i})=>e.jsxs(N,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-bold",children:"埋め込みスクリプト"}),e.jsx("span",{className:"text-muted-foreground mt-1 text-xs",children:"ウェブサイトの右下にチャットバブルを追加するには、このスクリプトタグをHTMLに追加します。"})]}),e.jsxs(I,{type:"button",variant:"outline",size:"sm",onClick:h,className:"h-8",children:[e.jsx(Ae,{className:"mr-2 h-4 w-4"}),"コピー"]})]}),e.jsx(w,{children:e.jsx("div",{className:"border-muted-foreground/20 bg-muted/50 dark:bg-muted/30 relative rounded-md border p-4",children:e.jsx("pre",{className:"h-[200px] overflow-y-auto font-mono text-xs whitespace-pre-wrap",children:e.jsx("code",{className:"h-full overflow-y-auto",children:i.value})})})}),e.jsx(P,{})]})}),e.jsxs("div",{className:"flex items-center justify-end gap-4 pt-4",children:[e.jsx(I,{type:"button",onClick:x,disabled:a,className:"h-10 w-24 text-white hover:opacity-90",style:{backgroundColor:"#6B7280"},children:"キャンセル"}),!o&&e.jsxs(I,{type:"button",onClick:g,disabled:a,className:"h-10 w-24 text-white hover:opacity-90",style:{backgroundColor:"#EF4444"},children:[e.jsx(he,{className:"size-4"}),"削除"]}),e.jsx(I,{type:"submit",disabled:a,className:"h-10 w-24 text-white hover:opacity-90",style:{backgroundColor:"#3B82F6"},children:a?o?"作成中...":"更新中...":o?"作成":"更新"})]})]})}),e.jsx(A,{open:b,onOpenChange:d,title:"削除の確認",desc:"このボットを削除してもよろしいですか？この操作は元に戻せません。",confirmText:"削除",cancelBtnText:"キャンセル",destructive:!0,handleConfirm:k,isLoading:a}),e.jsx(A,{open:s,onOpenChange:r,title:"変更を破棄しますか？",desc:"変更を保存せずにページを離れますか？保存されていない変更は失われます。",confirmText:"破棄",cancelBtnText:"キャンセル",handleConfirm:f,isLoading:a})]})]})}export{ct as B};
